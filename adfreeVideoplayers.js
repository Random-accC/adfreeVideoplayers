// ==UserScript==
// @name         adfreeVideoplayers
// @namespace    https://raw.githubusercontent.com/Random-accC/adfreeVideoplayers/
// @downloadURL  https://raw.githubusercontent.com/Random-accC/adfreeVideoplayers/master/adfreeVideoplayers.js
// @updateURL    https://raw.githubusercontent.com/Random-accC/adfreeVideoplayers/master/adfreeVideoplayers.js
// @version      0.4
// @description  Removes flash (object) video players from a bunch of known websites and replaces them with an ad-free HTML5 player.
// @author       Random-accC
// @match        http://*.focus.de/*
// @match        http://focus.de/*
// @match        https://focus.de/*
// @match        https://*.focus.de/*
// @match        http://*.winfuture.de/*
// @match        http://winfuture.de/*
// @match        https://winfuture.de/*
// @match        https://*.winfuture.de/*
// @grant        none
// ==/UserScript==

/*
This is the configuration:
autoplay true false - autostart vs no autostart
customStyling true false - external libraries (better look and feel) vs no external libraries (better privacy)
controls true false - default controls ('slider') vs no default controls (less)
customControls true false - custom controls ('nicer') vs no custom controls (less)
Some config parameters are able to influence or to change others.
*/

var configuration = {
    autoplay: false,
    customStyling: true,
    controls: false,
    customControls: true
};

!function(e,t){function n(e){var t=Math.floor(e/3600);t=10>t?"0"+t.toString():t;var n=Math.floor(e%3600/60);n=10>n?"0"+n.toString():n;var o=Math.floor(e%60);return o=10>o?"0"+o.toString():o,t+" : "+n+" : "+o}function o(){t&&console.log("Removing object-Nodes via CSS.");var e=document.createElement("style");e.innerHTML="object{display: none!important;}",e.setAttribute("type","text/css"),document.head.appendChild(e)}function i(e,n,o,i){t&&console.log("Adding HTML Player");var l=document.createElement("video");l.setAttribute("id",y),l.setAttribute("src",n),i&&l.setAttribute("controls","controls"),o&&l.setAttribute("autoplay","autoplay"),l.setAttribute("preload","auto"),l.setAttribute("width","720px"),l.setAttribute("min-width","100%"),l.setAttribute("height","420px"),l.setAttribute("min-height","100%"),l.setAttribute("style","position: relative; margin-left: auto; margin-right: auto; display: block!important;z-index: 100;"),e.setAttribute("style","display: block!important;"),e.insertBefore(l,e.firstChild),e.innerHTML='<span>Playing: <a href="'+n+'" target="_self">'+n+"</a></span><br>"+e.innerHTML,document.getElementById(y).volume=.5}function l(){t&&console.log("Injection vom bootstrapcdn.com and googleapis.com");for(var e=[{href:"https://ajax.googleapis.com/ajax/libs/jquery/1.11.4/jquery.min.js",type:"text/javascript"},{href:"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js",type:"text/javascript"},{href:"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css",type:"text/css",rel:"stylesheet"},{href:"https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css",type:"text/css",rel:"stylesheet"},{href:"https://code.jquery.com/ui/1.11.4/jquery-ui.js",type:"text/javascript"}],n=0;n<e.length;n++){var o=document.createElement("link");o.setAttribute("href",e[n].href),o.setAttribute("type",e[n].type),e[n].rel&&o.setAttribute("rel",e[n].rel),document.head.appendChild(o)}}function d(e,n,o){t&&console.log("Creating a button: [."+e+"] "+n);var i=document.createElement("span");i.setAttribute("class","glyphicon "+e),i.setAttribute("aria-hidden","true");var l=document.createElement("span");l.innerHTML=n;var d=document.createElement("button");return d.setAttribute("class","btn btn-sm btn-primary"),d.appendChild(i),d.appendChild(l),d.onclick=o,d.onmouseover=function(){this.setAttribute("class","btn btn-sm btn-success")},d.onmouseout=function(){this.setAttribute("class","btn btn-sm btn-primary")},d}function r(e){t&&console.log("Adding controls.");var n=(e.firstChild.nextSibling.nextSibling,document.createElement("div"));n.setAttribute("class","btn-toolbar"),n.setAttribute("role","toolbar"),n.setAttribute("id","accBlockVideoAdsControls"),n.setAttribute("style","display: block; width: 720px; position: relative; margin-left: auto; margin-right: auto; z-index: 1000; padding: 10px 10px 10px 10px;"),e.insertBefore(n,document.getElementById(y).nextSibling);var o=document.createElement("div");o.setAttribute("class","btn-group"),o.setAttribute("role","group");var i=document.createElement("div");i.setAttribute("class","btn-group"),i.setAttribute("role","group");var l=document.createElement("div");l.setAttribute("class","btn-group"),l.setAttribute("role","group"),n.appendChild(o),n.appendChild(i),n.appendChild(l),s(o),u(i),c(l)}function c(e){e.appendChild(d("glyphicon-resize-small",m?"":"- Size",function(){var e=document.getElementById(y).width,n=document.getElementById(y).height;document.getElementById(y).width=Math.round(e/1.1*100)/100,document.getElementById(y).height=Math.round(n/1.1*100)/100,t&&console.log("Toggling Size: "+document.getElementById(y).width+"x"+document.getElementById(y).height+"px")})),e.appendChild(d("glyphicon-resize-full",m?"":"+ Size",function(){var e=document.getElementById(y).width,n=document.getElementById(y).height;document.getElementById(y).width=Math.round(1.1*e*100)/100,document.getElementById(y).height=Math.round(1.1*n*100)/100,t&&console.log("Toggling Size: "+document.getElementById(y).width+"x"+document.getElementById(y).height+"px")}))}function u(e){e.appendChild(d("glyphicon-volume-off",m?"":"Mute",function(){var e=document.getElementById(y).volume;document.getElementById(y).volume=0==e?document.getElementById("slider").innerHTML:0,t&&console.log("Toggling Loudness: "+document.getElementById(y).volume)})),e.appendChild(d("glyphicon-volume-down",m?"":"- Vol",function(){var e=document.getElementById(y).volume;document.getElementById(y).volume=0>=e-.1?0:Math.round(100*(e-.1))/100,document.getElementById("slider").innerHTML=0==document.getElementById(y).volume?"0.0":document.getElementById(y).volume,t&&console.log("Toggling Loudness: "+document.getElementById(y).volume)})),function(e){var t=document.createElement("button");t.setAttribute("class","btn btn-sm btn-primary disabled"),t.setAttribute("disabled","disabled");var n=document.createElement("span");n.setAttribute("class","glyphicon glyphicon-signal"),t.appendChild(n);var o=document.createElement("span");o.setAttribute("id","slider"),o.setAttribute("style","padding-left: 6px;"),o.innerHTML="0.5",t.appendChild(o),e.appendChild(t)}(e),e.appendChild(d("glyphicon-volume-up",m?"":"+ Vol",function(){var e=document.getElementById(y).volume;document.getElementById(y).volume=e+.1>=1?1:Math.round(100*(e+.1))/100,document.getElementById("slider").innerHTML=1==document.getElementById(y).volume?"1.0":document.getElementById(y).volume,t&&console.log("Toggling Loudness: "+document.getElementById(y).volume)}))}function s(e){e.appendChild(d("glyphicon-fast-backward",m?"":"f Back",function(){var e=document.getElementById(y).currentTime;document.getElementById(y).currentTime=e-60>=0?e-60:0,t&&console.log("Jumping to: "+document.getElementById(y).currentTime)})),e.appendChild(d("glyphicon-backward",m?"":"Back",function(){var e=document.getElementById(y).currentTime;document.getElementById(y).currentTime=e-1>=0?e-1:0,t&&console.log("Jumping to: "+document.getElementById(y).currentTime)})),e.appendChild(d("glyphicon-play",m?"":"Play",function(){t&&console.log("Toggling Status: "+document.getElementById(y).paused);var e=document.getElementById(y).paused,n=e?"glyphicon glyphicon-pause":"glyphicon glyphicon-play";return this.firstChild.setAttribute("class",n),m||(this.firstChild.nextSibling.innerHTML=e?"Pause":"Play"),e?document.getElementById(y).play():document.getElementById(y).pause()})),function(){var t=document.createElement("button");t.setAttribute("class","btn btn-sm btn-primary disbaled"),t.setAttribute("disabled","disabled"),t.setAttribute("id","accBlockVideoAdsProgressbar"),e.appendChild(t)}(e),e.appendChild(d("glyphicon-forward",m?"":"For",function(){var e=document.getElementById(y).currentTime,n=document.getElementById(y).duration;document.getElementById(y).currentTime=n>=e+1?e+1:n,t&&console.log("Jumping to: "+document.getElementById(y).currentTime)})),e.appendChild(d("glyphicon-fast-forward",m?"":"f For",function(){var e=document.getElementById(y).currentTime,n=document.getElementById(y).duration;document.getElementById(y).currentTime=n>=e+60?e+60:n,t&&console.log("Jumping to: "+document.getElementById(y).currentTime)})),function o(){var e=document.getElementById(y).currentTime,i=document.getElementById(y).duration;t&&console.log("Refreshing progress: "+e+" / "+i),document.getElementById("accBlockVideoAdsProgressbar").innerHTML=n(Math.round(100*e)/100)+" / "+n(i),setTimeout(o,500)}()}var a=e.autoplay||!1,m=e.customStyling&&e.customControls||!1,g=e.controls||!0,p=e.customControls&&e.customStyling||!1,y="accCBlockVideoAds",h=window.location.hostname;t&&console.log("Running on: "+h);var b=null,v=null,f=null,E=document.body.innerHTML;switch(h){case"www.winfuture.de":case"winfuture.de":b=/video_id=([0-9]){0,}/i,v="http://videos.winfuture.de/"+b.exec(E)[0].replace("video_id=","")+".mp4",f=document.getElementsByClassName("video_content")[0],function(){t&&console.log("Trying to remove trashy elements.");var e="player"+b.exec(E)[0].replace("video_id=","");t&&console.log("Trying to remove Element[id="+e+"]");var n=document.getElementById(e);n&&n.parentNode&&n.parentNode.removeChild(n),t&&console.log("Trying to apply custom style.");var o=document.createElement("style");o.setAttribute("type","text/css"),o.innerHTML=".centForm{display:none!important;} .btn-sm{height:30px!important;}",document.head.appendChild(o)}();break;case"www.focus.de":case"focus.de":b=/videourl = (.){0,}\.mp4/i,v=b.exec(E)[0].replace('videourl = "',""),f=document.getElementById("videoPlayer"),function(){t&&console.log("Trying to remove trashy elements."),t&&console.log("Trying to apply custom style.");var e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML="#playerflashfwid1, #fwid1{display:none!important;} #videoPlayer{height:600px!important; display:block!important;}",document.head.appendChild(e)}();break;default:return void(t&&console.log("No pattern known for this page."))}return t&&console.log("Using this pattern: "+b),t&&console.log("Video found: "+v),v&&v.length>0&&f?(m&&l(),o(),i(f,v,a,g),void(p&&r(f,m))):void(t&&console.log("No video found."))}(configuration,!1);
